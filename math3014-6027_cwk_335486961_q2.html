<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="335486961">

<title>MATH6173 Coursework 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="math3014-6027_cwk_335486961_q2_files/libs/clipboard/clipboard.min.js"></script>
<script src="math3014-6027_cwk_335486961_q2_files/libs/quarto-html/quarto.js"></script>
<script src="math3014-6027_cwk_335486961_q2_files/libs/quarto-html/popper.min.js"></script>
<script src="math3014-6027_cwk_335486961_q2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="math3014-6027_cwk_335486961_q2_files/libs/quarto-html/anchor.min.js"></script>
<link href="math3014-6027_cwk_335486961_q2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="math3014-6027_cwk_335486961_q2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="math3014-6027_cwk_335486961_q2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="math3014-6027_cwk_335486961_q2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="math3014-6027_cwk_335486961_q2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MATH6173 Coursework 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>335486961 </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="install-and-load-required-libraries" class="level3">
<h3 class="anchored" data-anchor-id="install-and-load-required-libraries">Install and load required libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="do">##############################| echo: false</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"ibd"</span>)) <span class="fu">install.packages</span>(<span class="st">"ibd"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"FrF2"</span>)) <span class="fu">install.packages</span>(<span class="st">"FrF2"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load required libraries</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans) </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ibd)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(FrF2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(unrepx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q.2-a" class="level1">
<h1>Q.2 (a)</h1>
<p>The data set is reproduced as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tyre1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">treatment =</span> <span class="fu">rep</span>(<span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="dv">3</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">block =</span> <span class="fu">rep</span>(<span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">3</span>)),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">response =</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">9</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">21</span>,<span class="cn">NA</span>,<span class="dv">9</span>,<span class="cn">NA</span>,<span class="dv">15</span>,<span class="dv">8</span>,<span class="cn">NA</span>,<span class="dv">11</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>)<span class="co"># length(strength)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(tyre1, <span class="at">names_from =</span> treatment, <span class="at">values_from =</span> response),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Block"</span>, <span class="fu">paste</span>(<span class="st">"Teatment"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Question NO. 2"</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Question NO. 2</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Block</th>
<th style="text-align: right;">Teatment 1</th>
<th style="text-align: right;">Teatment 2</th>
<th style="text-align: right;">Teatment 3</th>
<th style="text-align: right;">Teatment 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here, the blocks have size k = 3,2,3, reespectively which is smaller than the number of treatments ( t = 4 ). Hence, each block cannot contain an application of each treatment. This is an example of an incomplete block design. Graphical exploration of the data is a little more problematic in this example. As each treatment does not occur in each block, box plots given by the following figures are not as informative.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(response <span class="sc">~</span> block, <span class="at">data =</span> tyre1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="math3014-6027_cwk_335486961_q2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(response <span class="sc">~</span> treatment, <span class="at">data =</span> tyre1)         </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="math3014-6027_cwk_335486961_q2_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The form of various important matrices including the <strong><em>incidence matrix</em></strong>, given by <strong>N</strong>, used through our analysis are provided below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a> one <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">kronecker</span>(<span class="fu">diag</span>(<span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">4</span>), one)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(   <span class="co">#  t(X2)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">nrow =</span> <span class="dv">8</span>, <span class="at">byrow =</span> T</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#incidence matrix</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X1</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>X1tX1 <span class="ot">&lt;-</span> <span class="fu">t</span>(X1) <span class="sc">%*%</span> X1 <span class="co"># diagonal</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>X2tX2 <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X2 <span class="co"># diagonal</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>H1 <span class="ot">&lt;-</span> X1 <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X1) <span class="sc">%*%</span> X1) <span class="sc">%*%</span> <span class="fu">t</span>(X1)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>ones <span class="ot">&lt;-</span> H1 <span class="sc">%*%</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>) <span class="co"># H1 f2s vector of 1s is also a vector of 1s</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X2 <span class="sc">-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> H1 <span class="sc">%*%</span> X2 <span class="co"># X2t(I - H1)X2</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">qr</span>(A)<span class="sc">$</span>rank <span class="co"># rank 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>X2tH1 <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> H1 <span class="co"># adjustment to y</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ones, X1, X2) <span class="co"># overall model matrix</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qr</span>(W)<span class="sc">$</span>rank <span class="co"># rank 7 (t+b - 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(N)             </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    0    1    1    1
[2,]    1    0    1    0
[3,]    1    1    0    1</code></pre>
</div>
</div>
<p>For our question, we obtain the following <strong>ANOVA Table to test the hypothesis of no treatment effect</strong> as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>bar.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> block <span class="sc">+</span> treatment, <span class="at">data =</span> tyre1)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bar.lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: response
          Df  Sum Sq Mean Sq F value  Pr(&gt;F)  
block      2  65.542  32.771  18.726 0.05069 .
treatment  3 103.833  34.611  19.778 0.04851 *
Residuals  2   3.500   1.750                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># str(summary(bar.lm) )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can estimate the contrasts between treatments using <em>emmeans</em> package as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tyre.s2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(bar.lm)<span class="sc">$</span>sigma         </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>bar.emm <span class="ot">&lt;-</span> emmeans<span class="sc">::</span><span class="fu">emmeans</span>(bar.lm, <span class="sc">~</span> treatment)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>contrastv1.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levs)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="st">'t1 v t2'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">'t1 v t3'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,  <span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>), <span class="st">'t1 v t4'</span><span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">contrast</span>(bar.emm)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast          estimate    SE df t.ratio p.value
 treatment1 effect    5.875 0.924  2   6.361  0.0620
 treatment2 effect   -1.125 0.875  2  -1.286  0.4364
 treatment3 effect   -5.125 0.924  2  -5.549  0.0620
 treatment4 effect    0.375 0.875  2   0.429  0.7100

Results are averaged over the levels of: block 
P value adjustment: fdr method for 4 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a> bar_crd.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span>  treatment, <span class="at">data =</span> tyre1)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>bar_crd.emm <span class="ot">&lt;-</span> emmeans<span class="sc">::</span><span class="fu">emmeans</span>(bar_crd.lm, <span class="sc">~</span> treatment)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">contrast</span>(bar_crd.emm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast          estimate   SE df t.ratio p.value
 treatment1 effect    7.125 1.63  4   4.359  0.0483
 treatment2 effect   -2.375 1.63  4  -1.453  0.2932
 treatment3 effect   -3.875 1.63  4  -2.371  0.1535
 treatment4 effect   -0.875 1.63  4  -0.535  0.6208

P value adjustment: fdr method for 4 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bar_crd.lm) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm.default(formula = response ~ treatment, data = tyre1)

Residuals:
   2    3    4    5    7    9   10   12 
 0.5 -2.0 -1.0  3.0  2.0 -3.0 -0.5  1.0 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   18.000      1.887   9.537 0.000675 ***
treatment2    -9.500      2.669  -3.559 0.023607 *  
treatment3   -11.000      2.669  -4.121 0.014601 *  
treatment4    -8.000      2.669  -2.997 0.040057 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.669 on 4 degrees of freedom
  (4 observations deleted due to missingness)
Multiple R-squared:  0.8351,    Adjusted R-squared:  0.7115 
F-statistic: 6.754 on 3 and 4 DF,  p-value: 0.04807</code></pre>
</div>
</div>
<p>Clearly, the null hypothesis of no treatment effect is rejected. The anova function also compares the block mean square to test the hypothesis of no Block effect.</p>
</section>
<section id="q.2-b" class="level1">
<h1>Q.2 (b)</h1>
<p>Now we directly calculate the <strong>q</strong> from treatment and block sums, using the <strong>incidence matrix</strong> and perform pairwise analysis as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bar.lm) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm.default(formula = response ~ block + treatment, data = tyre1)

Residuals:
   2    3    4    5    7    9   10   12 
 0.5  0.5 -1.0  0.5 -0.5 -0.5 -0.5  1.0 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  1.550e+01  1.449e+00  10.696  0.00863 **
block2       5.000e+00  1.449e+00   3.450  0.07471 . 
block3       2.719e-16  1.183e+00   0.000  1.00000   
treatment2  -7.000e+00  1.508e+00  -4.641  0.04343 * 
treatment3  -1.100e+01  1.449e+00  -7.591  0.01692 * 
treatment4  -5.500e+00  1.508e+00  -3.646  0.06766 . 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.323 on 2 degrees of freedom
  (4 observations deleted due to missingness)
Multiple R-squared:  0.9798,    Adjusted R-squared:  0.9291 
F-statistic: 19.36 on 5 and 2 DF,  p-value: 0.04985</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>trtsum <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(response <span class="sc">~</span>  treatment, <span class="at">data =</span> tyre1, <span class="at">FUN =</span> sum)[, <span class="dv">2</span>]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>blocksum <span class="ot">&lt;-</span> <span class="fu">aggregate</span>( response <span class="sc">~</span> block, <span class="at">data =</span> tyre1, <span class="at">FUN =</span> sum)[, <span class="dv">2</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> trtsum <span class="sc">-</span>blocksum  <span class="sc">%*%</span>  N<span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> T</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>k  <span class="ot">&lt;-</span> <span class="dv">3</span>; lambda <span class="ot">&lt;-</span> <span class="dv">2</span>; t <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>pe <span class="ot">&lt;-</span> k <span class="sc">*</span> C <span class="sc">%*%</span> <span class="fu">t</span>(q) <span class="sc">/</span> (lambda <span class="sc">*</span> t) <span class="co"># point esf2ates</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> k <span class="sc">*</span> tyre.s2 <span class="sc">/</span> (lambda <span class="sc">*</span> t)) <span class="co"># st error (same for each contrast)</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>t.ratio <span class="ot">&lt;-</span> pe <span class="sc">/</span> se</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>p.value <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">ptukey</span>(<span class="fu">abs</span>(t.ratio) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">2</span>), <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Pair =</span> <span class="fu">c</span>(<span class="st">'1v2'</span>,<span class="st">'1v3'</span>,<span class="st">'1v4'</span>,<span class="st">'2v3'</span>,<span class="st">'2v4'</span>,<span class="st">'3v4'</span>),</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">Esf2ate =</span>pe, <span class="at">St.err =</span> se, <span class="at">t.ratio =</span> t.ratio,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">p.value =</span> p.value, <span class="at">reject =</span> p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Pair Esf2ate    St.err    t.ratio     p.value reject
1  1v2   6.250 0.9960707  6.2746553 0.005704875   TRUE
2  1v3   6.875 0.9960707  6.9021208 0.003720679   TRUE
3  1v4   5.125 0.9960707  5.1452174 0.013467763   TRUE
4  2v3   0.625 0.9960707  0.6274655 0.918920164  FALSE
5  2v4  -1.125 0.9960707 -1.1294380 0.689605499  FALSE
6  3v4  -1.750 0.9960707 -1.7569035 0.388038943  FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>           tyre.emm <span class="ot">&lt;-</span> emmeans<span class="sc">::</span><span class="fu">emmeans</span>(bar.lm, <span class="sc">~</span> treatment)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">pairs</span>(tyre.emm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate   SE df t.ratio p.value
 treatment1 - treatment2      7.0 1.51  2   4.641  0.1059
 treatment1 - treatment3     11.0 1.45  2   7.591  0.0420
 treatment1 - treatment4      5.5 1.51  2   3.646  0.1624
 treatment2 - treatment3      4.0 1.51  2   2.652  0.2729
 treatment2 - treatment4     -1.5 1.32  2  -1.134  0.7106
 treatment3 - treatment4     -5.5 1.51  2  -3.646  0.1624

Results are averaged over the levels of: block 
P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
</div>
<p>For this experiment, treatments are significantly different at an experiment-wise type I error rate of 5%.</p>
</section>
<section id="q.2-c" class="level1">
<h1>Q.2 (C)</h1>
<p>There were <em>t = 8</em> treatments, defined via the settings of 2 different factors, as given in following Table. In the R code above, we have used the function <em>FrF2</em> (from the package of the same name) to generate all<br>
combinations of the two levels of these factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>           desilylation <span class="ot">&lt;-</span> FrF2<span class="sc">::</span><span class="fu">FrF2</span>(<span class="at">nruns =</span> <span class="dv">8</span>, <span class="at">nfactors =</span> <span class="dv">2</span>, <span class="at">randomize =</span> F,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">factor.names =</span> <span class="fu">list</span>(<span class="at">f1 =</span> <span class="fu">c</span>(<span class="st">"Low"</span>,<span class="st">"High"</span>), <span class="at">f2 =</span> <span class="fu">c</span>(<span class="st">"Low"</span>,<span class="st">"High"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>creating full factorial with 4 runs ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>           yield <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">21</span>,<span class="dv">9</span>,<span class="dv">15</span>,<span class="dv">8</span>,<span class="dv">11</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>           desilylation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(desilylation, <span class="at">yield =</span> yield)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rownames</span>(desilylation) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Trt"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>           knitr<span class="sc">::</span><span class="fu">kable</span>(desilylation, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Factor1"</span>, <span class="st">"Factor1"</span>, <span class="st">"Blocks"</span>,<span class="st">" Response"</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">caption =</span> <span class="st">"Desilylation experiment: 8 treatments defined </span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="st">             by settings of 2 factors, with response."</span>)           </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Desilylation experiment: 8 treatments defined by settings of 2 factors, with response.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Factor1</th>
<th style="text-align: left;">Factor1</th>
<th style="text-align: left;">Blocks</th>
<th style="text-align: right;">Response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Trt 1</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">.1</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 2</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">.1</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 3</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">.1</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 4</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">.1</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 5</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">.2</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 6</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">.2</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 7</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">.2</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 8</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">.2</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If we fit <strong>unit-treatment model</strong> and compute the ANOVA table, we notice a particular issue with this design.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>           desilylation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(desilylation, <span class="at">trt =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>           desilylation.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> trt, <span class="at">data =</span> desilylation)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">anova</span>(desilylation.lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in anova.lm(desilylation.lm): ANOVA F-tests on an essentially perfect
fit are unreliable</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: yield
          Df Sum Sq Mean Sq F value Pr(&gt;F)
trt        7 172.88  24.696     NaN    NaN
Residuals  0   0.00     NaN               </code></pre>
</div>
</div>
<pre><code>       All available degrees of freedom are being used to estimate parameters in the mean    and the treatment effects. There are *no degrees of freedom left to estimate  variance*. This is due to a lack of treatment replication.
              </code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>           desilylation.emm <span class="ot">&lt;-</span> emmeans<span class="sc">::</span><span class="fu">emmeans</span>(desilylation.lm, <span class="sc">~</span> trt)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>           reagent_me.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levs, ...) <span class="fu">data.frame</span>(<span class="st">'reagent m.e.'</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">2</span>)) <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>           emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">'reagent_me'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast     estimate  SE df t.ratio p.value
 reagent.m.e.    -0.25 NaN  0     NaN     NaN</code></pre>
</div>
</div>
<p>This contrast compares the average treatment effect from the treatments which have reagent set to its low level (1 equiv.) to the average effect from the treatments which have reagent set to its high level. This is a “fair” comparison, as both of these sets of treatments have each of the combinations of the both factors occuring equally often.</p>
<p>We can also <strong>calculate main effect</strong> estimates for these factors by defining appropriate contrasts in the treatments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>           contrast.mat <span class="ot">&lt;-</span> FrF2<span class="sc">::</span><span class="fu">FrF2</span>(<span class="at">nruns =</span> <span class="dv">8</span>, <span class="at">nfactors =</span> <span class="dv">2</span>, <span class="at">randomize =</span> F, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">factor.names =</span> <span class="fu">c</span>(<span class="st">"f1"</span>, <span class="st">"f2"</span>                                       ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>creating full factorial with 4 runs ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>           fac.contrasts.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levs, ...) </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>             dplyr<span class="sc">::</span><span class="fu">mutate_all</span>(<span class="fu">data.frame</span>(contrast.mat), <span class="cf">function</span>(x) <span class="fu">scale</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x)), <span class="at">scale =</span> <span class="dv">4</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>           main_effect_contrasts <span class="ot">&lt;-</span> <span class="fu">fac.contrasts.emmc</span>()</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rownames</span>(main_effect_contrasts) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Trt"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>           knitr<span class="sc">::</span><span class="fu">kable</span>(main_effect_contrasts, <span class="at">caption =</span> <span class="st">'Desilylation experiment: main effect contrast coefficients'</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Factor1"</span>, <span class="st">"Factor2"</span>, <span class="st">"Block"</span>))        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Desilylation experiment: main effect contrast coefficients</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Factor1</th>
<th style="text-align: right;">Factor2</th>
<th style="text-align: right;">Block</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Trt 1</td>
<td style="text-align: right;">-0.25</td>
<td style="text-align: right;">-0.25</td>
<td style="text-align: right;">-0.0125</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 2</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">-0.25</td>
<td style="text-align: right;">-0.0125</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 3</td>
<td style="text-align: right;">-0.25</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">-0.0125</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 4</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">-0.0125</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 5</td>
<td style="text-align: right;">-0.25</td>
<td style="text-align: right;">-0.25</td>
<td style="text-align: right;">0.0125</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 6</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">-0.25</td>
<td style="text-align: right;">0.0125</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 7</td>
<td style="text-align: right;">-0.25</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.0125</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 8</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.0125</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Estimates can be obtained by applying these coefficients to the observed treatment means as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>           <span class="fu">t</span>(<span class="fu">as.matrix</span>(main_effect_contrasts)) <span class="sc">%*%</span> yield</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]
f1      4.2500
f2      2.7500
Blocks -0.0125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>           emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">'fac.contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast estimate  SE df t.ratio p.value
 f1         4.2500 NaN  0     NaN     NaN
 f2         2.7500 NaN  0     NaN     NaN
 Blocks    -0.0125 NaN  0     NaN     NaN</code></pre>
</div>
</div>
<p>Following Figure presents the <strong>main effect plots</strong> for our data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>           <span class="do">## calculate the means</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>           f1_bar <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(yield <span class="sc">~</span> f1, <span class="at">data =</span> desilylation, <span class="at">FUN =</span> mean)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>           f2_bar <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(yield <span class="sc">~</span> f2, <span class="at">data =</span> desilylation, <span class="at">FUN =</span> mean)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>           <span class="do">## convert factors to numeric</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>           fac_to_num <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>           f1_bar<span class="sc">$</span>yield <span class="ot">&lt;-</span> <span class="fu">fac_to_num</span>(f1_bar<span class="sc">$</span>yield)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>           f2_bar<span class="sc">$</span>yield <span class="ot">&lt;-</span> <span class="fu">fac_to_num</span>(f2_bar<span class="sc">$</span>yield)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>           f1_bar<span class="sc">$</span>f1 <span class="ot">&lt;-</span> <span class="fu">fac_to_num</span>(f1_bar<span class="sc">$</span>f1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fac_to_num(f1_bar$f1): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>           f2_bar<span class="sc">$</span>f2 <span class="ot">&lt;-</span> <span class="fu">fac_to_num</span>(f2_bar<span class="sc">$</span>f2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fac_to_num(f2_bar$f2): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>           <span class="do">## main effect plots</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>           plotmin <span class="ot">&lt;-</span> <span class="fu">min</span>(f1_bar<span class="sc">$</span>yield, f2_bar<span class="sc">$</span>yield)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>           plotmax <span class="ot">&lt;-</span> <span class="fu">max</span>(f1_bar<span class="sc">$</span>yield, f2_bar<span class="sc">$</span>yield)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">par</span>(<span class="at">cex =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>           <span class="fu">plot</span>(f1_bar<span class="sc">$</span>yield, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col=</span><span class="st">"green"</span>, <span class="at">xlim =</span><span class="fu">c</span>(.<span class="dv">95</span>,<span class="fl">2.02</span>), <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax),<span class="at">lty=</span><span class="dv">3</span>,<span class="at">lwd =</span> <span class="dv">2</span>,<span class="at">pch =</span> <span class="dv">21</span>,  <span class="at">bg =</span> <span class="st">"maroon4"</span>,    <span class="at">cex =</span> <span class="fl">1.3</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="math3014-6027_cwk_335486961_q2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>           <span class="fu">plot</span>(f2_bar<span class="sc">$</span>yield, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col=</span><span class="st">"red"</span>,<span class="at">xlim =</span><span class="fu">c</span>(.<span class="dv">95</span>,<span class="fl">2.02</span>), <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax),<span class="at">lty=</span><span class="dv">3</span>,<span class="at">lwd =</span> <span class="dv">2</span>,<span class="at">pch =</span> <span class="dv">21</span>,  <span class="at">bg =</span> <span class="st">"blue"</span>,    <span class="at">cex =</span> <span class="fl">1.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="math3014-6027_cwk_335486961_q2_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For our data the following **interaction contrast* seems quite small, although of course without an estimate of the standard error we are still lacking a formal method to judge this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>           sol_reg_int.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levels, ...) </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">data.frame</span>(<span class="st">'reagent x solvent'</span> <span class="ot">=</span> .<span class="dv">125</span> <span class="sc">*</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">2</span>)))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>           emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">'sol_reg_int'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast          estimate  SE df t.ratio p.value
 reagent.x.solvent    -2.62 NaN  0     NaN     NaN</code></pre>
</div>
</div>
<p>To calculate the <em>contrast coefficients</em> we use the elementwise, or <em>Hadamard, product</em> as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>           fac.contrasts.int.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levs, ...) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">with</span>(<span class="fu">sqrt</span>(<span class="dv">4</span>) <span class="sc">*</span> main_effect_contrasts, {</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">data.frame</span>(<span class="st">'f1_x_f2'</span> <span class="ot">=</span> f1 <span class="sc">*</span> f2)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>             })</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>           }</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>           two_fi_contrasts <span class="ot">&lt;-</span> <span class="fu">fac.contrasts.int.emmc</span>()</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rownames</span>(two_fi_contrasts) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Trt"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>           knitr<span class="sc">::</span><span class="fu">kable</span>(two_fi_contrasts, <span class="at">caption =</span> <span class="st">'Desilylation experiment: two-factor interaction contrast coefficients'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Desilylation experiment: two-factor interaction contrast coefficients</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">f1_x_f2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Trt 1</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 2</td>
<td style="text-align: right;">-0.25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 3</td>
<td style="text-align: right;">-0.25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 4</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 5</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 6</td>
<td style="text-align: right;">-0.25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trt 7</td>
<td style="text-align: right;">-0.25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trt 8</td>
<td style="text-align: right;">0.25</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre><code>      **Estimates of the interaction contrasts** can be found by considering the equivalent contrasts in the observed treatment means.</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>           <span class="fu">t</span>(<span class="fu">as.matrix</span>(two_fi_contrasts)) <span class="sc">%*%</span> yield</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]
f1_x_f2 3.25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>            emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">'fac.contrasts.int'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast estimate  SE df t.ratio p.value
 f1_x_f2      3.25 NaN  0     NaN     NaN</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>            plotmin <span class="ot">&lt;-</span> <span class="fu">min</span>(desilylation<span class="sc">$</span>yield)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>            plotmax <span class="ot">&lt;-</span> <span class="fu">max</span>(desilylation<span class="sc">$</span>yield)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">par</span>(<span class="at">cex =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with main effects, interactions are displayed graphically using interaction plots, plotting average responses for each pairwise combination of factors, joined by lines as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>              <span class="fu">with</span>(desilylation, {</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">interaction.plot</span>(f1, f2, yield, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">legend =</span> F, </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">17</span>))</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"f2 = Low"</span> , <span class="st">"f2 = High "</span>), <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex =</span> .<span class="dv">75</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                           })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="math3014-6027_cwk_335486961_q2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="q.2-d" class="level1">
<h1>Q.2 (d)</h1>
<p>Now we can calculate <strong>all the three factorial effects</strong> as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>               <span class="do">## hadamard products</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>             unscaled_me_contrasts <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">*</span> main_effect_contrasts</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>             factorial_contrasts <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>.<span class="sc">^</span><span class="dv">4</span>, unscaled_me_contrasts)[, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>             <span class="do">## all factorial effects - directly, as there is no treatment replication</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">t</span>(factorial_contrasts) <span class="sc">%*%</span> yield</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                [,1]
f1            4.2500
f2            2.7500
Blocks       -0.0125
f1:f2         3.2500
f1:Blocks     0.0125
f2:Blocks    -0.2625
f1:f2:Blocks -0.2375</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>             <span class="co"># using emmeans</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>             factorial_contrasts.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levs, ...) <span class="fu">data.frame</span>(factorial_contrasts)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>             desilylation.effs <span class="ot">&lt;-</span> emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">'factorial_contrasts'</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>             desilylation.effs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast     estimate  SE df t.ratio p.value
 f1             4.2500 NaN  0     NaN     NaN
 f2             2.7500 NaN  0     NaN     NaN
 Blocks        -0.0125 NaN  0     NaN     NaN
 f1.f2          3.2500 NaN  0     NaN     NaN
 f1.Blocks      0.0125 NaN  0     NaN     NaN
 f2.Blocks     -0.2625 NaN  0     NaN     NaN
 f1.f2.Blocks  -0.2375 NaN  0     NaN     NaN</code></pre>
</div>
</div>
<p>The following Table gives the <em>ordered factorial effects</em>, which are then plotted against standard normal quantiles in subsequent Figure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>             effs <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">transform</span>(desilylation.effs)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], dplyr<span class="sc">::</span><span class="fu">desc</span>(estimate))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>             knitr<span class="sc">::</span><span class="fu">kable</span>(effs, <span class="at">caption =</span> <span class="st">"Desilylation experiment: sorted estimated factorial effects"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Desilylation experiment: sorted estimated factorial effects</caption>
<thead>
<tr class="header">
<th style="text-align: left;">contrast</th>
<th style="text-align: right;">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">f1</td>
<td style="text-align: right;">4.2500</td>
</tr>
<tr class="even">
<td style="text-align: left;">f1.f2</td>
<td style="text-align: right;">3.2500</td>
</tr>
<tr class="odd">
<td style="text-align: left;">f2</td>
<td style="text-align: right;">2.7500</td>
</tr>
<tr class="even">
<td style="text-align: left;">f1.Blocks</td>
<td style="text-align: right;">0.0125</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Blocks</td>
<td style="text-align: right;">-0.0125</td>
</tr>
<tr class="even">
<td style="text-align: left;">f1.f2.Blocks</td>
<td style="text-align: right;">-0.2375</td>
</tr>
<tr class="odd">
<td style="text-align: left;">f2.Blocks</td>
<td style="text-align: right;">-0.2625</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>              <span class="fu">qqnorm</span>(effs[ ,<span class="dv">2</span>], <span class="at">ylab =</span> <span class="st">"Factorial effects"</span>, <span class="at">main =</span> <span class="st">""</span>) <span class="co"># note that qqnorm/qqline/qqplot don't require sorted data</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">qqnorm</span>(effs[ ,<span class="dv">2</span>], <span class="at">ylab =</span> <span class="st">"Factorial effects"</span>, <span class="at">main =</span> <span class="st">""</span>) <span class="co"># note that qqnorm/qqline/qqplot don't require sorted data</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">qqline</span>(effs[ ,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="math3014-6027_cwk_335486961_q2_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is more usual to use a <em>half-normal plot</em> to assess the size of factorial effects, so we plot the sorted absolute values of the estimated effects against the quantiles of a half-normal distribution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>              p <span class="ot">&lt;-</span> .<span class="dv">5</span> <span class="sc">+</span> .<span class="dv">5</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span> <span class="sc">-</span> .<span class="dv">5</span>) <span class="sc">/</span><span class="dv">16</span> <span class="co"># probabilities we will plot against</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">qqplot</span>(<span class="at">x =</span> <span class="fu">qnorm</span>(p), <span class="at">y =</span> <span class="fu">abs</span>(effs[,<span class="dv">2</span>]), <span class="at">ylab =</span> <span class="st">"Absolute factorial effects"</span>, </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Half-normal quantiles"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="math3014-6027_cwk_335486961_q2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For our data we can construct the pseudo standard error (PSE) as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>             s0 <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">median</span>(<span class="fu">abs</span>(effs[, <span class="dv">2</span>]))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>             trimmed <span class="ot">&lt;-</span> <span class="fu">abs</span>(effs[, <span class="dv">2</span>]) <span class="sc">&lt;</span> <span class="fl">2.5</span> <span class="sc">*</span> s0</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>             pse <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">median</span>(<span class="fu">abs</span>(effs[trimmed, <span class="dv">2</span>]))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>             pse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1875</code></pre>
</div>
</div>
<p>From package unrepx the function eff.test calculates unadjusted p-values (p.value) and simultaneous p-values (simult.pval) adjusted to account for multiple testing. We see that <em>the main effects are significant</em> at the experiment-wise <em>5%</em> level and, obeying effect heredity, their interaction (the p-value is borderline, and hovers around 0.05 depending on simulation error).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>             eff_est <span class="ot">&lt;-</span> effs[, <span class="dv">2</span>]</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">names</span>(eff_est) <span class="ot">&lt;-</span> effs[, <span class="dv">1</span>]</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>             lenth_tests <span class="ot">&lt;-</span> unrepx<span class="sc">::</span><span class="fu">eff.test</span>(eff_est, <span class="at">method =</span> <span class="st">"Lenth"</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>             knitr<span class="sc">::</span><span class="fu">kable</span>(lenth_tests, <span class="at">caption =</span> <span class="st">"Desilylation experiment: hypothesis tests using Lenth's method."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Desilylation experiment: hypothesis tests using Lenth’s method.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">effect</th>
<th style="text-align: right;">Lenth_PSE</th>
<th style="text-align: right;">t.ratio</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">simult.pval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">f1</td>
<td style="text-align: right;">4.2500</td>
<td style="text-align: right;">0.1875</td>
<td style="text-align: right;">22.667</td>
<td style="text-align: right;">0.0002</td>
<td style="text-align: right;">0.0012</td>
</tr>
<tr class="even">
<td style="text-align: left;">f1.f2</td>
<td style="text-align: right;">3.2500</td>
<td style="text-align: right;">0.1875</td>
<td style="text-align: right;">17.333</td>
<td style="text-align: right;">0.0005</td>
<td style="text-align: right;">0.0026</td>
</tr>
<tr class="odd">
<td style="text-align: left;">f2</td>
<td style="text-align: right;">2.7500</td>
<td style="text-align: right;">0.1875</td>
<td style="text-align: right;">14.667</td>
<td style="text-align: right;">0.0007</td>
<td style="text-align: right;">0.0037</td>
</tr>
<tr class="even">
<td style="text-align: left;">f2.Blocks</td>
<td style="text-align: right;">-0.2625</td>
<td style="text-align: right;">0.1875</td>
<td style="text-align: right;">-1.400</td>
<td style="text-align: right;">0.1525</td>
<td style="text-align: right;">0.6304</td>
</tr>
<tr class="odd">
<td style="text-align: left;">f1.f2.Blocks</td>
<td style="text-align: right;">-0.2375</td>
<td style="text-align: right;">0.1875</td>
<td style="text-align: right;">-1.267</td>
<td style="text-align: right;">0.1839</td>
<td style="text-align: right;">0.7228</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blocks</td>
<td style="text-align: right;">-0.0125</td>
<td style="text-align: right;">0.1875</td>
<td style="text-align: right;">-0.067</td>
<td style="text-align: right;">0.9553</td>
<td style="text-align: right;">1.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">f1.Blocks</td>
<td style="text-align: right;">0.0125</td>
<td style="text-align: right;">0.1875</td>
<td style="text-align: right;">0.067</td>
<td style="text-align: right;">0.9553</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The package <em>unrepx</em> also provides the function <em>hnplot</em> to display these results graphically by adding a reference line to a half-normal plot. The ME and SME lines in the following plot indicate the absolute size of effects that would be required to reject null hypothesis at an individual or experimentwise significance level, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>             unrepx<span class="sc">::</span><span class="fu">hnplot</span>(eff_est, <span class="at">method =</span> <span class="st">"Lenth"</span>, <span class="at">horiz =</span> F, <span class="at">ID =</span> <span class="fl">2.7</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="math3014-6027_cwk_335486961_q2_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>